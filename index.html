<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>千与千寻</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap');
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            transition: filter 0.5s ease;
        }

        body.dimmed {
            filter: brightness(100%);
        }

        .watermark-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }
        
        .watermark {
            position: absolute;
            font-size: 3rem;
            font-weight: 800;
            color: rgba(0, 0, 0, 0.07);
            animation: float 25s infinite ease-in-out;
            user-select: none;
            padding: 10px;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .version-info {
            position: fixed;
            left: 50%;
            bottom: 10px;
            font-size: 14px;
            color: #666;
            transform: translateX(-50%);
        }

        .container {
            margin: 15px;
            padding: 10px;
            background: rgba(55, 37, 37, 0.055);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 50px);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .player-container {
            margin: 90px;
            width: 1300px;
            height: 700px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            border-radius: 10px;
            position: relative;
        }

        .music {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: relative;
            height: 100%;
            width: 100%;
        }

        .title {
            font-weight: 400;
            font-size: 2em;
            color: #38a7ff;
            display: inline-flex;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .detail-container {
            position: relative;
            top: -15px;
            width: 1200px;
            margin: 0 5px 0px 5px;
            height: 550px;
            padding: 0px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            z-index: 5;
            box-shadow: -10px -10px 15px #fff,
                        10px 10px 15px rgba(0, 0, 0, 0.1),
                        inset -5px -5px 15px #fff,
                        inset 5px 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .detail-container span {
            font-size: 1.2em;
            color: #555;
            display: block;
            margin-bottom: 10px;
        }
        .language-en {
            position: relative;
            margin: 10px 10px 10px 25px;
            height: 450px;
            width: 1150px;
            border-radius: 10px;
        }

        .language-line {
            width: 1150px;
            margin: 0px 10px 0px 25px;
            height: 3px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
        }

        .language-zh {
            position: relative;
            margin: 10px 10px 10px 25px;
            height: 65px;
            width: 1150px;
            border-radius: 10px;
        }

        .language-zh span {
            flood-color: #333;
        }
        
        .player {
            position: relative;
            width: 600px;
            min-height: 50px;
            background: #fbfbfb;
            border: 2px solid #fff;
            border-radius: 80px;
            padding: 20px 30px;
            box-shadow: -10px -10px 15px #fff,
                        10px 10px 15px rgba(0, 0, 0, 0.1),
                        inset -5px -5px 15px #fff,
                        inset 5px 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
            transform: translateY(1px);
        }
        .btns {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .btns span {
            position: relative;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btns span:hover {
            color: #38a7ff;
            transform: scale(1.1);
        }
        
        .btns span:active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0,0,0,0.025),
                        inset 0 5px 10px rgba(0,0,0,0.1);
        }
        .btns span:active,
        .btns span.active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0, 0, 0, 0.025),
                inset 0 5px 10px rgba(0, 0, 0, 0.15);
        }
        .btns span.playPause {
            width: 60px;
            height: 60px;
        }

        .btns span ion-icon {
            font-size: 1.5em;
        }

        .btns span.playPause ion-icon {
            font-size: 2em;
        }

        .progress-all {
            position: absolute;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            width: 588px;
        }
        
        .progress-container {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .progress {
            height: 100%;
            background: #38a7ff;
            width: 0%;
            border-radius: 10px;
            transition: width 0.1s ease;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            color: #777;
            font-size: 14px;
        }

        .language-btn {
            position: absolute;
            top: -11px;
            left: 15px;
            min-width: 10px;
            height: 22px;
            border-radius: 15px;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            padding: 0 10px;
            gap: 5px;
        }

        .language-btn:hover {
            color: #38a7ff;
            transform: scale(1.05);
        }

        .language-btn:active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0,0,0,0.025),
                        inset 0 5px 10px rgba(0,0,0,0.1);
        }

        .language-btn ion-icon {
            font-size: 0.9em;
        }
        
        .language-text {
            font-size: 0.8em;
            font-weight: 500;
        }

        .play-model {
            position: relative;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .play-model ion-icon {
            position: absolute;
            transition: opacity 0.3s ease;
        }
        
        .play-model .icon-hidden {
            opacity: 0;
        }

        .help-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .help-btn:hover {
            color: #38a7ff;
            transform: scale(1.1);
        }

        .help-btn:active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0,0,0,0.025),
                        inset 0 5px 10px rgba(0,0,0,0.1);
        }

        .help-btn ion-icon {
            font-size: 1.5em;
        }

        .detail-btn {
            position: absolute;
            top: 39px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .detail-btn:hover {
            color: #38a7ff;
            transform: scale(1.1);
        }

        .detail-btn:active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0,0,0,0.025),
                        inset 0 5px 10px rgba(0,0,0,0.1);
        }

        .detail-btn ion-icon {
            font-size: 1.5em;
        }
        
        /* 新增弹窗样式 */
        .help-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 50%;
            max-width: 500px;
            height: auto;
            background: rgba(235, 235, 235, 0.894);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .help-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .modal-content {
            text-align: center;
            color: #555;
            font-size: 1.2rem;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            color: #38a7ff;
            transform: scale(1.1);
        }
        
        .modal-close:active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0,0,0,0.025),
                        inset 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .modal-close ion-icon {
            font-size: 1.5em;
        }

        .lyrics-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 80%;
            max-width: 900px;
            height: 70%;
            background: rgba(235, 235, 235, 0.894);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            padding: 20px 15px 15px 15px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
            display: flex;
            flex-direction: column;
        }
        
        .lyrics-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .lyrics-modal .my-lines {
            position: absolute;
            bottom: 80px;
            right: 80px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001; /* 确保在lyrics-content之上 */
        }
        
        .lyrics-modal .my-lines:hover {
            color: #38a7ff;
            transform: scale(1.1);
        }
        
        .lyrics-modal .my-lines:active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0,0,0,0.025),
                        inset 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .lyrics-modal .my-lines ion-icon {
            font-size: 2em;
        }

        .lyrics-content {
            flex: 1;
            overflow-y: auto;
            margin: 5px;
            padding-right: 10px;
            /* 添加3D翻转相关样式 */
            transform-style: preserve-3d;
            transition: transform 0.8s;
        }
        
        .lyrics-content.flipped {
            transform: rotateY(180deg);
        }
        
        .lyrics-list {
            list-style: none;
            padding: 0;
            margin: 0;
            backface-visibility: hidden;
        }
        
        .lyric-item {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: rgba(240, 240, 240, 0.7);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .lyric-item:hover {
            background: rgba(56, 167, 255, 0.1);
            transform: translateX(5px);
        }
        
        .lyric-item.active {
            background: rgba(56, 167, 255, 0.2);
            border-left: 4px solid #38a7ff;
        }
        
        .lyric-en {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 5px;
        }
        
        .lyric-zh {
            font-size: 1rem;
            color: #666;
        }
                
        /* 遮罩层 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }
        
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }


        .list-number-btns {
            top: -10px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .list-number-btns span {
            position: relative;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            box-shadow: inset 0 -5px 5px rgba(0,0,0,0.1),
                        0 5px 10px rgba(0,0,0,0.1),
                        0 10px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .list-number-btns span:hover {
            color: #38a7ff;
            transform: scale(1.1);
        }
        
        .list-number-btns span:active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0,0,0,0.025),
                        inset 0 5px 10px rgba(0,0,0,0.1);
        }
        .list-number-btns span:active,
        .list-number-btns span.active {
            color: #ff669a;
            box-shadow: inset 0 -7px 5px rgba(0, 0, 0, 0.025),
                        inset 0 5px 10px rgba(0, 0, 0, 0.15);
        }

        /* 自定义列表样式 */
        .my-lines.active {
            color: #38a7ff;
            box-shadow: inset 0 -5px 5px rgba(56, 167, 255, 0.1),
                        0 5px 10px rgba(56, 167, 255, 0.1),
                        0 10px 15px rgba(56, 167, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="watermark-container" id="watermarkContainer"></div>
        <div class="player-container">
            <!-- 添加详细信息按钮 -->
            <div class="detail-btn" id="detailBtn">
                <ion-icon name="color-wand-outline"></ion-icon>
            </div>
            
            <!-- 添加帮助按钮 -->
            <div class="help-btn" id="helpBtn">
                <ion-icon name="help-circle-outline"></ion-icon>
            </div>

            <div class="music">
                <div class="detail-container">
                    <div class="language-en">
                        En:<h2 class="title"></h2>
                        <span>
                            分析图表 原文, 成分
                        </span>
                    </div>
                    <div class="language-line">
                    </div>
                    <div class="language-zh">
                        <span>
                            这里是对应英语句子的翻译
                        </span>
                    </div>
                </div>

                <div class="player">
                    <!-- 修改语言按钮 -->
                    <div class="language-btn" id="languageBtn">
                        <span class="language-text">en</span>
                    </div>
                    
                    <audio src=""></audio>
                    <div class="btns">
                        <span class="play-model" id="playModeBtn">
                            <ion-icon name="remove-outline" data-mode="single" ></ion-icon>
                            <ion-icon name="sync-outline" data-mode="single-loop" class="icon-hidden"></ion-icon>
                            <ion-icon name="reorder-three-outline" data-mode="list" class="icon-hidden"></ion-icon>
                            <ion-icon name="sync-outline" data-mode="list-loop" class="icon-hidden"></ion-icon>
                        </span>

                        <span class="prev">
                            <ion-icon name="play-back-outline"></ion-icon>
                        </span>

                        <span class="playPause">
                            <ion-icon name="play-outline"></ion-icon>
                        </span>
                        
                        <span class="next">
                            <ion-icon name="play-forward-outline"></ion-icon>
                        </span>

                        <!-- 台词列表 -->
                        <span class="lines-list" id="linesListBtn">
                            <ion-icon name="list-outline"></ion-icon>
                        </span>
                    </div>
                </div>
                <!-- 进度条现在使用绝对定位靠近底部 -->
                <div class="progress-all">
                    <!-- 新增进度条 -->
                    <div class="progress-container" id="progressContainer">
                        <div class="progress"></div>
                    </div>
                    <div class="time-display">
                        <span class="current-time">0:00</span>
                        <span class="duration">0:00</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- 更新版本号 -->
        <div class="version-info">v.0.1.0</div>
    </div>
    
    <!-- 新增帮助弹窗 -->
    <div class="help-modal" id="helpModal">
        <span class="modal-close" id="helpModalClose">
            <ion-icon name="close-outline"></ion-icon>
        </span>
        <div class="modal-content">
            <!-- 不需要添加任何内容 -->
             帮助信息, 图文解说界面功能
        </div>
    </div>
    
    <!-- 台词列表弹窗 -->
    <div class="lyrics-modal" id="lyricsModal">
        <div class="list-number-btns">
            <span class="list-number-1" id="listNumberBtn-1">1</span>
            <span class="list-number-2" id="listNumberBtn-2">2</span>
            <span class="list-number-3" id="listNumberBtn-3">3</span>
            <span class="list-number-4" id="listNumberBtn-4">4</span>
            <span class="list-number-5" id="listNumberBtn-5">5</span>
            <span class="list-number-6" id="listNumberBtn-6">6</span>
            <span class="list-number-7" id="listNumberBtn-7">7</span>
            <span class="list-number-8" id="listNumberBtn-8">8</span>
            <span class="list-number-9" id="listNumberBtn-9">9</span>
            <span class="list-number-10" id="listNumberBtn-10">10</span>
        </div>

        <span class="my-lines" id="myLinesBtn">
            <ion-icon name="reader-outline"></ion-icon>
        </span>
        <div class="lyrics-content">
            <ul class="lyrics-list" id="lyricsList">
                <!-- 台词内容将通过JavaScript动态添加 -->
            </ul>
        </div>
    </div>
    
    <!-- 遮罩层 -->
    <div class="overlay" id="overlay"></div>
</body>

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script>
    // 获取元素
    const title = document.querySelector('.title');
    const prev = document.querySelector('.prev');
    const playPause = document.querySelector('.playPause');
    const next = document.querySelector('.next');
    const audio = document.querySelector('audio');
    const progressContainer = document.getElementById('progressContainer');
    const progress = document.querySelector('.progress');
    const currentTimeEl = document.querySelector('.current-time');
    const durationEl = document.querySelector('.duration');
    const languageBtn = document.getElementById('languageBtn');
    const languageText = languageBtn.querySelector('.language-text');
    const playModeBtn = document.getElementById('playModeBtn');
    const playModeIcons = playModeBtn.querySelectorAll('ion-icon');
    const helpBtn = document.getElementById('helpBtn');
    const detailBtn = document.getElementById('detailBtn');
    const linesListBtn = document.getElementById('linesListBtn');
    const lyricsModal = document.getElementById('lyricsModal');
    const lyricsList = document.getElementById('lyricsList');
    const overlay = document.getElementById('overlay');
    const myLinesBtn = document.getElementById('myLinesBtn');
    const lyricsContent = document.querySelector('.lyrics-content');
    
    // 新增弹窗元素
    const detailModal = document.getElementById('detailModal');
    const helpModal = document.getElementById('helpModal');
    const helpModalClose = document.getElementById('helpModalClose');
    
    // 语言选项和状态
    const languageOptions = ['en', 'zh', 'en,zh'];
    let currentLanguageIndex = 0;
    
    // 播放模式选项和状态
    const playModes = ['single', 'single-loop', 'list', 'list-loop'];
    let currentPlayModeIndex = 0;
    
    // 自定义列表状态
    let is_my_lines = false;
    
    // 自定义台词列表数据
    const myLyricsList = [
        {
            en: "This is my favorite line from the movie.",
            songName: "My Selection 1"
        },
        {
            en: "Remember who you are and don't lose yourself.",
            songName: "My Selection 2"
        },
        {
            en: "Once you've met someone you never really forget them.",
            songName: "My Selection 3"
        },
        {
            en: "I finally get a bouquet and it's a goodbye present.",
            songName: "My Selection 4"
        },
        {
            en: "Don't lose yourself! Always remember your name.",
            songName: "My Selection 5"
        }
    ];

    // 切换语言函数
    function toggleLanguage() {
        currentLanguageIndex = (currentLanguageIndex + 1) % languageOptions.length;
        languageText.textContent = languageOptions[currentLanguageIndex];
        
        // 可以根据选择的语言执行相应操作
        console.log('Language changed to:', languageOptions[currentLanguageIndex]);
    }
    
    // 切换播放模式函数
    function togglePlayMode() {
        // 隐藏所有图标
        playModeIcons.forEach(icon => icon.classList.add('icon-hidden'));
        
        // 更新模式索引
        currentPlayModeIndex = (currentPlayModeIndex + 1) % playModes.length;
        
        // 显示当前模式的图标
        const currentMode = playModes[currentPlayModeIndex];
        const currentIcon = Array.from(playModeIcons).find(icon => icon.getAttribute('data-mode') === currentMode);
        if (currentIcon) {
            currentIcon.classList.remove('icon-hidden');
            if (currentMode === 'single-loop') {
                let icon = Array.from(playModeIcons).find(icon => icon.getAttribute('data-mode') === 'single');
                icon.classList.remove('icon-hidden');
            } else if (currentMode === 'list-loop' ) {
                let icon = Array.from(playModeIcons).find(icon => icon.getAttribute('data-mode') === 'list');
                icon.classList.remove('icon-hidden');
            }
        }
        
        // 可以根据选择的播放模式执行相应操作
        console.log('Play mode changed to:', currentMode);
        
        // 更新播放模式的实际功能
        updatePlayMode(currentMode);
    }
    
    // 更新播放模式的实际功能
    function updatePlayMode(mode) {
        switch(mode) {
            case 'single':
                // 单曲播放一次
                audio.loop = false;
                break;
            case 'single-loop':
                // 单曲循环
                audio.loop = false;
                break;
            case 'list':
                // 列表播放一次
                audio.loop = false;
                break;
            case 'list-loop':
                // 列表循环
                audio.loop = true;
                break;
        }
    }
    
    // 显示详细信息弹窗
    function showDetailModal() {
        console.log('showDetailModal')
    }
    
    // 显示帮助弹窗
    function showHelpModal() {
        // 降低页面亮度
        document.body.classList.add('dimmed');
        
        // 显示遮罩层和弹窗
        overlay.classList.add('active');
        helpModal.classList.add('active');
    }
    
    // 关闭所有弹窗
    function closeAllModals() {
        // 恢复页面亮度
        document.body.classList.remove('dimmed');
        
        // 隐藏遮罩层和所有弹窗
        overlay.classList.remove('active');
        helpModal.classList.remove('active');
        lyricsModal.classList.remove('active');
    }
    
    // 显示台词列表
    function showLyricsList() {
        // 降低页面亮度
        document.body.classList.add('dimmed');
        
        // 显示遮罩层和弹窗
        overlay.classList.add('active');
        lyricsModal.classList.add('active');
        
        // 填充台词列表
        populateLyricsList();
    }
    
    // 填充台词列表
    function populateLyricsList() {
        lyricsList.innerHTML = '';
        
        // 根据is_my_lines状态选择要显示的列表
        const listToShow = is_my_lines ? myLyricsList : songList;
        
        // 为每首歌添加台词
        listToShow.forEach((song, index) => {
            const lyricItem = document.createElement('li');
            lyricItem.className = 'lyric-item';
            lyricItem.dataset.songIndex = index;
            
            let content = '';
            if (song.en) content += `<div class="lyric-en">${song.en}</div>`;
            if (song.songName) content += `<div class="lyric-zh">${song.songName}</div>`;
            
            lyricItem.innerHTML = content;
            
            // 添加点击事件
            lyricItem.addEventListener('click', () => {
                // 切换到对应歌曲
                if (currentSongIndex !== index || !song_Playing) {
                    currentSongIndex = index;
                    loadSong(listToShow[currentSongIndex]);
                }
                
                if (!song_Playing) playSong();
                
                // 关闭弹窗
                closeAllModals();
            });
            
            lyricsList.appendChild(lyricItem);
        });
    }
    
    // 切换自定义列表状态
    function toggleMyLines() {
        is_my_lines = !is_my_lines;
        
        // 添加3D翻转效果
        lyricsContent.classList.add('flipped');
        
        // 等待动画完成后更新内容
        setTimeout(() => {
            // 更新myLines按钮样式
            if (is_my_lines) {
                myLinesBtn.classList.add('active');
                progressContainer.style.background = '#B6CBBD';
            } else {
                myLinesBtn.classList.remove('active');
                progressContainer.style.background = '#e0e0e0';
            }
            
            // 如果歌词弹窗是打开的，刷新列表
            if (lyricsModal.classList.contains('active')) {
                populateLyricsList();
            }
            
            // 移除翻转效果以便下次使用
            setTimeout(() => {
                lyricsContent.classList.remove('flipped');
            }, 100);
            
            console.log('My lines mode:', is_my_lines ? 'ON' : 'OFF');
        }, 400); // 等待翻转动画完成一半
    }
    
    // 添加语言切换事件
    languageBtn.addEventListener('click', toggleLanguage);
    
    // 添加播放模式切换事件
    playModeBtn.addEventListener('click', togglePlayMode);
    
    // 添加帮助按钮点击事件
    helpBtn.addEventListener('click', showHelpModal);
    
    // 添加详细信息按钮点击事件
    detailBtn.addEventListener('click', showDetailModal);
    
    // 添加台词列表按钮点击事件
    linesListBtn.addEventListener('click', showLyricsList);
        
    // 添加遮罩层点击事件（点击遮罩层也可以关闭弹窗）
    overlay.addEventListener('click', closeAllModals);
    
    // 添加弹窗关闭按钮点击事件
    helpModalClose.addEventListener('click', closeAllModals);
    
    // 添加myLines按钮点击事件
    myLinesBtn.addEventListener('click', toggleMyLines);
    
    //first,we will create song list
    const songList = [
        {
            path: "./music/1.mp3",
            songName: "One Summer's Day",
            en: "The name of that river..."
        },
        {
            path: "./music/2.mp3",
            songName: "The Sixth Station",
            en: "Once you've met someone you never really forget them."
        },
        {
            path: "./music/3.mp3",
            songName: "The Bottomless Pit",
            en: "Don't lose yourself!"
        },
        {
            path: "./music/4.mp3",
            songName: "Nighttime Coming",
            en: "Once you do something, you never forget."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        },
        {
            path: "./music/5.mp3",
            songName: "Dragon Boy",
            en: "I finally get a bouquet and it's a goodbye present."
        }
    ];
    let song_Playing = false;
    let currentSongIndex = 0;

    // 加载歌曲
    function loadSong(song) {
        title.textContent = song.songName;
        audio.src = song.path;

        // 重置进度条
        progress.style.width = '0%';
        currentTimeEl.textContent = '0:00';

        // 当元数据加载完成后更新总时长
        audio.addEventListener('loadedmetadata', function() {
            const duration = audio.duration;
            const minutes = Math.floor(duration / 60);
            const seconds = Math.floor(duration % 60);
            durationEl.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        });
    }

    //play song
    function playSong(){
        song_Playing = true;
        audio.play();
        playPause.classList.add('active');
        //change icon
        playPause.innerHTML = '<ion-icon name="pause-outline"></ion-icon>';
    }

    //pause song
    function pauseSong(){
        song_Playing = false;
        audio.pause();
        playPause.classList.remove('active');
        //change icon
        playPause.innerHTML = '<ion-icon name="play-outline"></ion-icon>';
    }

    //play or pause song on click
    playPause.addEventListener("click", () => (song_Playing ? pauseSong() : playSong()));

    //prev song
    function prevSong(){
        currentSongIndex--;
        if (currentSongIndex < 0 ){
            currentSongIndex = songList.length - 1;
        }
        loadSong(songList[currentSongIndex]);
        playSong();
    }
    prev.addEventListener("click", prevSong);

    //next song
    function nextSong(){
        currentSongIndex++;
        if (currentSongIndex > songList.length - 1){
            currentSongIndex = 0;
        }
        loadSong(songList[currentSongIndex]);
        playSong();
    }
    next.addEventListener("click", nextSong);

    // 更新进度条
    function updateProgress(e) {
        const { duration, currentTime } = e.srcElement;
        if (duration) {
            const progressPercent = (currentTime / duration) * 100;
            progress.style.width = `${progressPercent}%`;
            
            // 更新当前时间显示
            const currentMinutes = Math.floor(currentTime / 60);
            const currentSeconds = Math.floor(currentTime % 60);
            currentTimeEl.textContent = `${currentMinutes}:${currentSeconds < 10 ? '0' : ''}${currentSeconds}`;
        }
    }
    
    // 设置进度条
    function setProgress(e) {
        const width = this.clientWidth;
        const clickX = e.offsetX;
        const duration = audio.duration;
        audio.currentTime = (clickX / width) * duration;
    }

    // 事件监听
    audio.addEventListener('timeupdate', updateProgress);
    audio.addEventListener('ended', nextSong); // 歌曲结束时自动播放下一首
    progressContainer.addEventListener('click', setProgress);

    // 初始化加载第一首歌
    loadSong(songList[currentSongIndex]);

    // 新增：list-number-btns按钮点击事件
    document.addEventListener('DOMContentLoaded', function() {
        const listNumberBtns = document.querySelectorAll('.list-number-btns span');
        
        // 初始化第一个按钮为激活状态
        listNumberBtns[0].classList.add('active');
        
        // 为每个按钮添加点击事件
        listNumberBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // 移除所有按钮的active类
                listNumberBtns.forEach(b => b.classList.remove('active'));
                
                // 为当前点击的按钮添加active类
                this.classList.add('active');
                
                // 这里可以添加其他逻辑，比如加载对应编号的歌词列表
                console.log('Selected list:', this.textContent);
            });
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('watermarkContainer');
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            let density = 77; // 中等密度
            let placedLetters = []; // 存储已放置字母的信息
            
            // 创建水印
            function createWatermarks() {
                container.innerHTML = '';
                placedLetters = [];
                const { width, height } = container.getBoundingClientRect();
                const maxAttempts = 100; // 每个字母的最大尝试次数
                
                for (let i = 0; i < density; i++) {
                    const watermark = document.createElement('div');
                    watermark.className = 'watermark';
                    const letter = letters[Math.floor(Math.random() * letters.length)];
                    watermark.textContent = letter;
                    
                    // 随机大小
                    const size = Math.random() * 7;
                    watermark.style.fontSize = `${size}rem`;
                    
                    // 随机旋转
                    const rotate = Math.random() * 30 - 15;
                    watermark.style.transform = `rotate(${rotate}deg)`;
                    
                    // 随机动画延迟
                    const delay = Math.random() * 20;
                    watermark.style.animationDelay = `${delay}s`;
                                        
                    // 估算字母尺寸（添加边距）
                    const letterWidth = size * 20 + 40; // 近似宽度
                    const letterHeight = size * 20 + 40; // 近似高度
                    
                    // 尝试找到不重叠的位置
                    let placed = false;
                    let attempts = 0;
                    
                    while (!placed && attempts < maxAttempts) {
                        attempts++;
                        
                        // 随机位置
                        const left = Math.random() * (width - letterWidth);
                        const top = Math.random() * (height - letterHeight);
                        
                        // 检查是否与已放置字母重叠
                        const overlaps = checkOverlap(left, top, letterWidth, letterHeight);
                        
                        if (!overlaps) {
                            // 位置有效，放置字母
                            watermark.style.left = `${left}px`;
                            watermark.style.top = `${top}px`;
                            container.appendChild(watermark);
                            
                            // 存储字母信息用于后续碰撞检测
                            placedLetters.push({
                                left,
                                top,
                                right: left + letterWidth,
                                bottom: top + letterHeight
                            });
                            
                            placed = true;
                        }
                    }                    
                }
            }
            
            // 检查是否与已放置字母重叠
            function checkOverlap(left, top, width, height) {
                const right = left + width;
                const bottom = top + height;
                
                // 检查边界
                if (right > container.clientWidth || bottom > container.clientHeight) {
                    return true;
                }
                
                // 检查与已放置字母的重叠
                for (const placed of placedLetters) {
                    if (!(right < placed.left || 
                          left > placed.right || 
                          bottom < placed.top || 
                          top > placed.bottom)) {
                        return true; // 重叠
                    }
                }
                
                return false; // 不重叠
            }
            
            // 初始化水印
            createWatermarks();
            
            // 调整窗口大小时重新创建水印
            window.addEventListener('resize', createWatermarks);
        });
</script>
</html>